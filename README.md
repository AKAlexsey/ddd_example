# CtiKaltura

# CTI интеграция с Kaltura

Nuff said

# Amnesia
В качестве базы данных в KalturaServer используется Amnesia враппер на Elixir вокруг Mnesia.
Позволяет пользоваться Mnesia гораздо удобнее. Например при запросе возвращает структуру а не массив. 
Позволяет делать запрос к таблице по значению поля.
Таблицы описаны в файле `/apps/kaltura_server/lib/caching/domain_model.ex`
Перед использованием необходимо инициировать базу данных.

```elixir
mix amnesia.create -d DomainModel --disk
```

Это создаст схему а параметр `--disk` указывает на то, что схема будет сохранена на диск.

## Возможные проблемы

### Изменение атрибутов одной из таблиц

Если изменились поля одной из таблиц DomainModel, то операции чтения и записи будут возвращать :badarg.

Решение:

Локально или после деплоя - дропнуть и создать заново схему базу данных.
При этом данные с диска будут удалены. В будущем необходимо написать скрипт. Который совершает эти действия.
И при этом делает запрос на получение всех данных KalturaServer из KalturaAdmin

```elixir
mix amnesia.drop -d DomainModel
mix amnesia.create -d DomainModel --disk
```
